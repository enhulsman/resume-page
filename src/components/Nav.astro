---
import { md5Hex } from '../lib/md5';
import site from '../config/site';
import ThemeToggle from './ThemeToggle.tsx';
import { gravatarUrl } from '../lib/gravatar';

const links = [
  { href: '/', label: 'About' },
  { href: '/resume', label: 'Resume' },
  { href: '/projects', label: 'Projects' },
];

// Get current path to determine if we're on home page
const currentPath = Astro.url.pathname;
const isHomePage = currentPath === '/';
---
<nav class="sticky top-0 z-40 backdrop-blur bg-theme-elevated border-b border-theme-primary">
  <div class="mx-auto max-w-6xl px-3 sm:px-6">
    <!-- Mobile Layout (< sm) -->
    <div class="sm:hidden">
      <!-- Top Row: Name + Actions -->
      <div class="flex h-12 items-center justify-between">
        <div class="flex items-center gap-2 min-w-0 flex-1">
          <a href="/" class="font-semibold tracking-tight text-theme-primary transition-colors duration-200 truncate">{site.name}</a>
          {!isHomePage && (
            <img
              src={gravatarUrl}
              onerror="this.onerror=null;this.src='/avatar.svg'"
              alt={site.name}
              width={24}
              height={24}
              class="w-6 h-6 rounded-full ring-1 ring-indigo-200/50 object-cover shadow-sm flex-shrink-0"
            />
          )}
        </div>
        <div class="flex items-center gap-2 flex-shrink-0">
          <ThemeToggle client:load />
          <a href="/contact" class="btn-theme-accent inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium shadow-sm hover:opacity-95 transition-all duration-200">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
            </svg>
            CV
          </a>
        </div>
      </div>
      <!-- Bottom Row: Navigation Links -->
      <div class="flex h-10 items-center justify-center border-t border-theme-primary/20">
        <div class="flex items-center gap-6">
          {links.map((l) => (
            <a href={l.href} class="text-sm text-theme-tertiary hover:text-theme-primary transition-colors duration-200">{l.label}</a>
          ))}
        </div>
      </div>
    </div>

    <!-- Desktop Layout (â‰¥ sm) -->
    <div class="hidden sm:flex h-14 items-center justify-between">
      <div class="flex items-center gap-3">
        <a href="/" class="font-semibold tracking-tight text-theme-primary transition-colors duration-200">{site.name}</a>
        {!isHomePage && (
          <img
            src={gravatarUrl}
            onerror="this.onerror=null;this.src='/avatar.svg'"
            alt={site.name}
            width={32}
            height={32}
            class="w-8 h-8 rounded-full ring-2 ring-indigo-200/50 object-cover shadow-sm"
          />
        )}
      </div>
      <div class="flex items-center gap-4">
        <div class="hidden sm:flex items-center gap-6">
          {links.map((l) => (
            <a href={l.href} class="link-social text-sm">{l.label}</a>
          ))}
        </div>
        <div class="flex items-center gap-3">
          <ThemeToggle client:load />
          <a href="/contact" class="btn-theme-accent-enhanced inline-flex items-center gap-1.5 rounded-md px-3 py-1.5 text-sm font-medium transition-all duration-200">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
            </svg>
            <span><span class="hidden lg:inline">Request </span>CV</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</nav>
